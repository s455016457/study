<!DOCTYPE html>
<html>
<head>
    <title>Main</title>
    @Styles.Render("~/Content/themes/css")
    @Styles.Render("~/Content/themes/default/css")
    <script src="@Url.Content("~/Scripts/EasyUi/jquery.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/EasyUi/jquery.easyui.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/EasyUi/locale/easyui-lang-zh_CN.js")" type="text/javascript"></script>
    <script src="~/Scripts/jquery.easyui.plus.js"></script>
</head>
<body class="easyui-layout">
    <script type="text/javascript">
        var dataGrid = {};
        dataGrid.options = {
            methord: 'post',
            fit: true,
            border: true,
            fitColumns: true,
            pageSize: 20,
            pageList: [15, 20, 30, 50, 100],
            pagination: true,
            remoteSort: true,
            striped: true, //奇偶行是否区分
            singleSelect: false,//单选模式
            rownumbers: true//行号
        };

        var btnSearch = {
            text: 'Search',
            iconCls: 'icon-search',
            disabled: false,
            display: true,
            handler: function () { createSearchView(btnSearch.url); }
        };
        var btnDetail = {
            text: 'Detail',
            disabled: false,
            display: true,
            url: "Home/Detail",
            iconCls: 'icon-detail',
            handler: function () { createDetailView(btnDetail.url); }
        };
        var btnAdd = {
            text: 'Add',
            disabled: false,
            display: true,
            url: "Home/Create",
            iconCls: 'icon-add',
            handler: function () { createAddView(btnAdd.url); }
        };
        var btnEdit = {
            text: 'Edit',
            disabled: false,
            display: true,
            url: "Home/Edit",
            iconCls: 'icon-edit',
            handler: function () { createEditView(btnEdit.url); }
        };
        var btnRemove = {
            text: 'Remove',
            disabled: false,
            display: true,
            iconCls: 'icon-remove',
            handler: function () { deleteSelected(); }
        };
        var btnExport = {
            text: 'Export',
            disabled: false,
            display: true,
            iconCls: 'icon-export',
            handler: function () { alert('Export') }
        };
        var btnReload = {
            text: 'Reload',
            disabled: false,
            display: true,
            iconCls: 'icon-reload',
            handler: function () { reload(); }
        };
        var array = [btnSearch, btnDetail, btnAdd, btnEdit, btnRemove, btnExport, btnReload];

        $(function () {
            dataGrid.options.toolbar = [];
            $(array).each(function (i) {
                if (this.display) {
                    dataGrid.options.toolbar.push(this);
                }
            });
        });

        function createAddView(url) {
            if (!url) {
                url = "Error/UrlIsInvalid";
            }
            $("#modalwindow").html("<iframe width='100%' height='98%' scrolling='no' frameborder='0'' src='" + url + "'></iframe>");
            $("#modalwindow").window({ title: '新增', width: 750, height: 500, iconCls: 'icon-add' }).window('open');
        }

        function createEditView(url) {
            if (!url) {
                url = "Error/UrlIsInvalid";
            }
            var row = $('#List').datagrid('getSelected');
            if (row != null) {
                url += "?" + $.param(row);
                $("#modalwindow").html("<iframe width='100%' height='98%' scrolling='no' frameborder='0'' src='" + url + "'></iframe>");
                $("#modalwindow").window({ title: '更新', width: 750, height: 500, iconCls: 'icon-edit' }).window('open');
            } else { $.messageBox3s('提示', '请选择要操作的记录'); }
        }

        function createDetailView(url) {
            if (!url) {
                url = "Error/UrlIsInvalid";
            }
            var row = $('#List').datagrid('getSelected');
            if (row != null) {
                url += "?" + $.param(row);
                $("#modalwindow").html("<iframe width='100%' height='98%' scrolling='no' frameborder='0'' src='" + url + "'></iframe>");
                $("#modalwindow").window({ title: '详细信息', width: 750, height: 500, iconCls: 'icon-detail' }).window('open');
            } else { $.messageBox3s('提示', '请选择要操作的记录'); }
        }

        function createSearchView(url) {
            if (!url) {
                url = "Error/UrlIsInvalid";
            }
            $("#searchwindow").html("<iframe width='100%' height='98%' scrolling='no' frameborder='0'' src='" + url + "'></iframe>");
            $("#searchwindow").window({ title: '筛选', width: 350, height: 500, iconCls: 'icon-search' }).window('open');
        }

        function deleteSelected() {
            var rows = $('#List').datagrid('getSelections');
            if (rows != null && rows.length > 0) {
                $.messager.confirm('提示', '确定删除选择项？', function (r) {
                    if (r) {
                        var i = 0;
                        var callService = function () {
                            if (i < rows.length) {
                                var row = rows[i++];
                                console.log("--------------delete row---------");
                                console.log(row);
                                $.post("/SysSample/Delete?id=" + row.Id, function (data) {
                                    callService();
                                }, "json");
                            } else {
                                $("#List").datagrid('load');
                            }
                        }
                        callService();
                    }
                });
            } else { $.messageBox3s('提示', '请选择要操作的记录'); }
        }

        function reload() {
            $("#List").datagrid('load');
        }
    </script>
    <div style="padding: 2px" data-options="region:'center',border:false">
        <div id="modalwindow"></div>
        <div id="searchwindow"></div>
        <table id="List"></table>
        @RenderBody()
    </div>
</body>
</html>
